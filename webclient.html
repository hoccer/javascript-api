<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Test</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Robert Palmer">
	<!-- Date: 2010-12-15 -->
	<script src="lib/jquery-1.4.4.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/file-uploader/client/fileuploader.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	
	<script src="lib/linccer.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/filecache.js" type="text/javascript" charset="utf-8"></script>
	
	<script type="text/javascript" charset="utf-8">
		window.onload = function() {
			FileCache("upload_form");
			

			var linccer = Linccer();
			
			linccer.on('sent', function(data) {
				console.log("sent!!!!!! " + data);
			});
			
			linccer.on('ready', function() {
				$("#waiting").css("display", "none");
				$("#coordinates").css("display", "inline");
			})
			
			linccer.on('updated_environment', function(data) {
				console.log('updated environments!!!!!');
			});
			
			linccer.on('received', function(data) {
				console.log("received: " + data[0]["0"].content);
				document.getElementById("input").value = data[0]["0"].content;
			});
			
			if (navigator.geolocation) {
	      navigator.geolocation.getCurrentPosition(function(position) {
	        console.log(position.coords.latitude + " " + position.coords.longitude);

	        linccer.setEnvironmentCoordinates(position.coords.latitude, 
	          position.coords.longitude, position.coords.accuracy, position.timestamp);
	
					$("#coordinates").html( position.coords.latitude + " " + position.coords.longitude );
	      },
	      function(error) {
	        console.log("error:" + error.message);
	      }
	      , {maximumAge:Infinity}); 
	    }			
		}
		
		function receive_action() {
			linccer.receive("one-to-many")
		}
		
		function send_action() {
			var content = document.getElementById("input").value;
			var data = [
					{
						"type": "text/plain",
						"content": content
					}
				];
				 
			linccer.send("one-to-many", data);
		}		
	</script>
	
	<style type="text/css" media="screen">
	
		#content { width: 500px; margin: 0 auto}
		#content div { margin-top: 20px;}
		#location #coordinates { display: none; }
	</style>
	
</head>
<body>

	<div id="content">
		<div id="location">
			<span id="waiting">locating...</span>
			<span id="coordinates">32,12 1212</span>
		</div>

		<div>
			<form method="POST" action="http://localhost:9999/v3/?expires_in=120" id="upload_form">
				File: <input type="file" name="upload[filename]" />
				<input type="submit" /> -->
			</form>	
			<input id="input" type="text" />
			<br />
		</div>
		<div>
			<a href="javascript:receive_action()">Receive</a>
			<a href="javascript:send_action()">Send</a>
		</div>
				

	</div>
</body>
</html>
